{# expects: site.url and page.url available #}
{% set target = site.url + (page.url | url) %}
{% set wm = target | wmLoad %}

<section>
    <h2>Responses ({{ wm.counts.total or 0 }})</h2>

    {# Reaction summary #}
<p>
üëç {{ wm.counts.like or 0}}
üîÅ {{ wm.counts.repost or 0}}
‚Ü©Ô∏è {{ wm.counts.reply or 0}}
üí¨ {{ wm.counts.mention or 0}}
</p>

{# Replies #}
  {% set replies = wm.items | selectattr("wm-property", "equalto", "reply") | list %}
  {% if replies | length %}
  <div class="wm-replies">
    {% for m in replies %}
      <article class="wm-reply">
        <header>
          <a href="{{ (m.author and m.author.url) or m.url | default('#') }}">
            {% if m.author and m.author.photo %}
              <img src="{{ m.author.photo }}" alt="" width="32" height="32" loading="lazy">
            {% endif %}
            <strong>{{ (m.author and m.author.name) or (m.url and (m.url | url)) }}</strong>
          </a>
          {% if m.published %}
            <time datetime="{{ m.published }}">{{ m.published | htmlDateString }}</time>
          {% endif %}
        </header>
        <p>{{ (m.content and m.content.text) or "" | escape }}</p>
        <p><a href="{{ m.url }}">Permalink</a></p>
      </article>
    {% endfor %}
  </div>
  {% endif %}

  {# Likes + Reposts as avatar rows #}
    {% set likes = wm.items | selectattr("wm-property", "equalto", "like") | list %}
    {% set reposts = wm.items | selectattr("wm-property", "equalto", "repost") | list %}

    {% if likes | length %}
    <div class="wm-likes">
      <h3>Likes ({{ likes | length }})</h3>
      <p class="wm-faces">
        {% for m in likes %}
          <a class="wm-face" href="{{ (m.author and m.author.url) or m.url | default('#') }}" title="{{ (m.author and m.author.name) or '' }}">
            {% if m.author and m.author.photo %}
              <img src="{{ m.author.photo }}" alt="{{ (m.author and m.author.name) or '' }}" width="24" height="24" loading="lazy">
            {% else %}
              <span>‚Ä¢</span>
            {% endif %}
          </a>
        {% endfor %}
      </p>
    </div>
    {% endif %}

    {% if reposts | length %}
      <div class="wm-reposts">
        <h3>Reposts ({{ reposts | length }})</h3>
        <p class="wm-faces">
          {% for m in reposts %}
            <a class="wm-face" href="{{ (m.author and m.author.url) or m.url | default('#') }}" title="{{ (m.author and m.author.name) or '' }}">
              {% if m.author and m.author.photo %}
                <img src="{{ m.author.photo }}" alt="{{ (m.author and m.author.name) or '' }}" width="24" height="24" loading="lazy">
              {% else %}
                <span>‚Ä¢</span>
              {% endif %}
            </a>
          {% endfor %}
        </p>
      </div>
      {% endif %}
    </section>
