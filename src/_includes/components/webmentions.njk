{# LOCATE WEBMEnTIONS FOR THIS PAGE #}
{% set target = site.url + (page.url | url) %}
{% set wm = target | wmLoad %}

{% if wm and (wm.counts.total or 0) > 0 %}
<section class="webmentions">
  <h2>Responses ({{ wm.counts.total }})</h2>
  <p>👍 {{ wm.counts.like or 0 }} · 🔁 {{ wm.counts.repost or 0 }} · 💬 {{ wm.counts.reply or 0 }} · ✨ {{ wm.counts.mention or 0 }}</p>

  <ul class="wm-list">
    {% for m in wm.items %}
      {% if not m['wm-private'] %}
        {% set author_url = (m.author and m.author.url) or m.url or "#" %}
        {% set author_name = (m.author and m.author.name) or m.url or "Someone" %}
        {% set when = m.published or m["wm-received"] %}
        {% set hasContent = m.content and (m.content.html or m.content.text) %}

        {% if hasContent %}
        <li class="wm-item">
          <article>
            <header>
              <a href="{{ author_url }}">
                {% if m.author and m.author.photo %}
                  <img src="{{ m.author.photo }}" alt="" width="32" height="32" loading="lazy" decoding="async">
                {% endif %}
                <strong>{{ author_name | escape }}</strong>
              </a>
              {% if when %}<time datetime="{{ when }}">{{ when }}</time>{% endif %}
            </header>

            <div class="wm-body e-content">
              {% if m.content.html %}
                {{ m.content.html | safe }}
              {% else %}
                <p>{{ m.content.text | escape }}</p>
              {% endif %}
            </div>
          </article>
        </li>
        {% endif %}
      {% endif %}
    {% endfor %}
  </ul>
</section>
{% endif %}
